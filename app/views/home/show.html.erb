<div class="container">
  <div class="row">
    <div class="col-md-12">
      <div id="user">Btc Address: <%= @user.btc_address %> | Balance: <%= @user.get_balance %> <span class="glyphicon glyphicon-bitcoin" /></div>
      <div id="transfer_form" class="alert-success">
        <h2>Send Bitcoins, Donate To Charity, Be Entered To Win A Prize</h2>
        <%= form_for @entry, html: {class: "form-inline", role: "form"} do |f| %>
          <% if @entry.errors.any? %>
            <div id="error_explanation">
              <h2><%= pluralize(@entry.errors.count, "error") %> prohibited this entry from being saved:</h2>

              <ul>
              <% @entry.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
              </ul>
            </div>
          <% end %>

          <div class="form-group text-center">
            <%= f.label :recipient %>:
            <%= f.select(:recipient, options_for_select(@users.map(&:btc_address)), class: "form-control") %>
            <%= f.number_field :total, min: 0.00, step: 0.00001, class: "form-control", placeholder: 'Total BTC' %>
            <%= f.hidden_field :sender, value: @user.btc_address %>

            <h2>Pick a charity</h2>

            <% @charities.each do |charity| %>
              <label>
                <%= f.radio_button("charity_id", charity.id) %>
                <%= charity.name %>
              </label>
              <br>
            <% end %>

            <br><%= f.check_box :terms %> <%= link_to 'I accept the terms', terms_path %>
            <%= f.submit "Send", class: "btn btn-success btn-lg" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div id="prize_pools" class="alert-warning">
        <h2>Current Prize Pools</h2>
        <ol>
          <% @prize_pools.each do |prize_pool| %>
            <li><%= "#{prize_pool.name} | #{prize_pool.total}" %> <span class="glyphicon glyphicon-bitcoin"></span></li>
          <% end %>
        </ol>
      </div>
    </div>

    <div class="col-md-6">
      <div id="entries_feed" class="alert-warning">
        <h2>Charity Donations to Date</h2>
        <ol>
          <% @charities.each do |charity| %>
            <li><%= "#{charity.name} | #{charity.lifetime_contributions}" %> <span class="glyphicon glyphicon-bitcoin"></span></li>
          <% end %>
        </ol>

        <h2>Latest Winners</h2>
        <ol>
          <% @entries.each do |entry| %>
            <li><%= entry.sender %></li>
          <% end %>
        </ol>
      </div>
    </div>
  </div>

  <% if @new_transfer %>
    <div id="transfer_instructions">
    </div>
    <div class="echocoin-modal modal fade" id="memberModal" tabindex="-1" role="dialog" aria-labelledby="memberModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="memberModalLabel">Notice</h4>
          </div>

          <div class="modal-body">
             <p>This is where you would scan the QR code below with your bitcoin wallet software to create a bitcoin transaction.</p>
             <p>For this demo, we'll go ahead and enter you into the prize drawing and pretend that's what happened once you click close.</p>
             <%= image_tag("sample_qr.png") %>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <% if @new_user %>
    <div class="echocoin-modal modal fade" id="memberModal" tabindex="-1" role="dialog" aria-labelledby="memberModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="memberModalLabel">Welcome new Echocoin user!</h4>
          </div>

          <div class="modal-body">
            <p>
              During the Rails Rumble, this site does not use real bitcoins and is operating in a simulation mode.
            </p>

            <p>
              You will be able to simulate sending bitcoin to other users of the site
              by selecting a bitcoin address from a dropdown menu.

              Therefore, we are assigning you this test bitcoin address for use during judging.
            </p>

            <div class="bitcoin_address">
              <%= @user.btc_address %>
            </div>

            <p>
              This will display in the upper right as your user id. Other users of the site can send you
              bitcoin and any prize pools that you win will be paid to this address.
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
